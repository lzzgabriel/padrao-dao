<!DOCTYPE html>
<html lang="pt_BR" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta charset="utf-8" />
	<h:outputStylesheet library="webjars"
		name="primeflex/3.3.1/primeflex.css" />
	<link type="text/css" rel="stylesheet"
		href="./resources/css/global.css?v=#{crudView.currentTimestamp}" />
	<title>Padrão DAO</title>
</h:head>

<h:body styleClass="m-0">

	<div id="header" class="p-2 flex text-white-alpha-90 bg-indigo-600">
		<h4 class="mx-2">Padrão DAO - LzzGabriel</h4>
		<a href="https://github.com/lzzgabriel/padrao-dao" target="_blank"
			class="flex align-items-center link-clean"><i
			class="text-3xl pi pi-github"></i></a>
	</div>

	<h:form>

		<p:growl id="msgs" showDetail="true" globalOnly="true">
			<p:autoUpdate on="obsMsg" />
		</p:growl>

		<div id="content">

			<p:dataTable id="dt-usuario" value="#{crudView.usuarios}"
				stripedRows="true" size="small" var="usuario" editable="true"
				styleClass="mb-8" reflow="true">

				<p:ajax event="rowEdit" listener="#{crudView.onRowEdit}"
					update="@obs(obsMsg)" />

				<p:column styleClass="dt-15">
					<f:facet name="header">
						<div class="flex justify-content-center">
							<h:outputText>Nome</h:outputText>
						</div>
					</f:facet>
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{usuario.nome}" />
						</f:facet>
						<f:facet name="input">
							<p:inputText styleClass="w-full" value="#{usuario.nome}" />
						</f:facet>
					</p:cellEditor>
				</p:column>
				<p:column styleClass="dt-15">
					<f:facet name="header">
						<div class="flex justify-content-center">
							<h:outputText>E-mail</h:outputText>
						</div>
					</f:facet>
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{usuario.email}" />
						</f:facet>
						<f:facet name="input">
							<p:inputText styleClass="w-full" value="#{usuario.email}" />
						</f:facet>
					</p:cellEditor>
				</p:column>
				<p:column styleClass="dt-20">
					<f:facet name="header">
						<div class="flex justify-content-center">
							<h:outputText>Endereço</h:outputText>
						</div>
					</f:facet>
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{usuario.enderecoNumero}" />
						</f:facet>
						<f:facet name="input">
							<p:inputText value="#{usuario.endereco}" styleClass="" />
							<p:inputText value="#{usuario.numero}" styleClass="" />
						</f:facet>
					</p:cellEditor>
				</p:column>
				<p:column styleClass="dt-20">
					<f:facet name="header">
						<div class="flex justify-content-center">
							<h:outputText>Cidade</h:outputText>
						</div>
					</f:facet>
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{usuario.cidadeEstado}" />
						</f:facet>
						<f:facet name="input">
							<p:inputText value="#{usuario.municipio}" />
							<p:selectOneMenu value="#{usuario.uf}">
								<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
								<f:selectItems value="#{crudView.estados}" var="estado" />
							</p:selectOneMenu>
						</f:facet>
					</p:cellEditor>
				</p:column>
				<p:column styleClass="dt-15">
					<f:facet name="header">
						<div class="flex justify-content-center">
							<h:outputText>Momento de cadastro</h:outputText>
						</div>
					</f:facet>
					<h:outputText styleClass="flex justify-content-center"
						value="#{usuario.momentoCadastro}" converter="instantConverter" />
				</p:column>
				<p:column styleClass="dt-10">
					<p:rowEditor editTitle="Editar linha" cancelTitle="Cancelar edição"
						saveTitle="Salvar linha" />
				</p:column>
				<p:column styleClass="dt-5">
					<p:commandButton icon="pi pi-trash" partialSubmit="true"
						process="@this" styleClass="rounded-button ui-button-danger"
						actionListener="#{crudView.deleteUsuario(usuario)}">
						<p:confirm header="Confirmação" message="Deseja mesmo excluir?"
							icon="pi pi-exclamation-triangle" />
					</p:commandButton>
				</p:column>

				<p:autoUpdate on="save" />

			</p:dataTable>

			<p:commandButton value="Inserir usuário" icon="pi pi-plus"
				actionListener="#{crudView.openNew()}" partialSubmit="true"
				process="@this" styleClass="m-3 ui-button-warning insert-button"
				onclick="PF('manageDialog').show()" />

		</div>

		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade"
			responsive="true" width="auto">
			<p:commandButton value="Não" type="button"
				styleClass="ui-confirmdialog-no ui-button-flat" />
			<p:commandButton value="Sim" type="button"
				styleClass="ui-confirmdialog-yes" />
		</p:confirmDialog>

		<p:dialog widgetVar="manageDialog" modal="true" closeOnEscape="true">
			<h:panelGroup id="manage-dialog-content">
				<div class="formgrid grid">
					<div class="field col">
						<p:outputLabel for="@next">Nome</p:outputLabel>
						<p:inputText styleClass="w-full" required="true"
							requiredMessage="Obrigatório"
							value="#{crudView.selectedUsuario.nome}" />
						<p:message for="@previous" display="text"
							style="display:grid;height:0;padding:0;margin:0" />
					</div>
					<div class="field col">
						<p:outputLabel for="@next">E-mail</p:outputLabel>
						<p:inputText styleClass="w-full" required="true"
							requiredMessage="Obrigatório" validator="emailValidator"
							validatorMessage="Inválido"
							value="#{crudView.selectedUsuario.email}" />
						<p:message for="@previous" display="text"
							style="display:grid;height:0;padding:0;margin:0" />
					</div>
				</div>
				<div class="formgrid grid">
					<div class="field col">
						<p:outputLabel for="@next">Logradouro</p:outputLabel>
						<p:inputText styleClass="w-full"
							value="#{crudView.selectedUsuario.endereco}" />
					</div>
					<div class="field col">
						<p:outputLabel for="@next">Número</p:outputLabel>
						<p:inputText styleClass="w-full"
							value="#{crudView.selectedUsuario.numero}" />
					</div>
				</div>
				<div class="formgrid grid">
					<div class="field col">
						<p:outputLabel for="@next">Cidade</p:outputLabel>
						<p:inputText styleClass="w-full"
							value="#{crudView.selectedUsuario.municipio}" />
					</div>
					<div class="field col">
						<p:outputLabel>UF</p:outputLabel>
						<p:selectOneMenu styleClass="w-full"
							value="#{crudView.selectedUsuario.uf}">
							<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
							<f:selectItems value="#{crudView.estados}" var="estado" />
						</p:selectOneMenu>
					</div>
				</div>
				<p:autoUpdate on="save" />
			</h:panelGroup>

			<div class="flex justify-content-end my-2">
				<p:commandButton value="Salvar" icon="pi pi-check"
					actionListener="#{crudView.saveUsuario()}"
					styleClass="ui-button-warning" partialSubmit="true"
					process="@this manage-dialog-content"
					update="@this @obs(save) msgs dt-usuario"
					oncomplete="if (args &amp;&amp; args.hideDialog) { PF('manageDialog').hide() }" />
			</div>

		</p:dialog>

	</h:form>

</h:body>

</html>